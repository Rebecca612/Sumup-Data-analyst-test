create or replace view WEB_ORDERS_BRONZE(
	DATE,
	COUNTRY_CODE,
	CAMPAIGN_ID,
	TOTAL_SPEND_EUR,
	NB_OF_SESSIONS,
	NB_OF_SIGNUPS,
	NB_OF_ORDERS,
	NB_OF_POSLITE_ITEMS_ORDERED,
	NB_POSLITE_ITEMS_DISPATCHED
) as
SELECT
    DATE,
    -- Standardize country
    CASE 
        WHEN LOWER(TRIM(COUNTRY_CODE)) = 'unknown' THEN NULL
        ELSE UPPER(TRIM(COUNTRY_CODE))
    END AS COUNTRY_CODE,
    -- Campaign ID as integer
    CAST(CAMPAIGN_ID AS NUMBER(38,0)) AS CAMPAIGN_ID,
    CASE 
        WHEN TOTAL_SPEND_EUR < 0 THEN NULL
        ELSE TOTAL_SPEND_EUR
    END AS TOTAL_SPEND_EUR,
    -- Sessions
    CASE 
        WHEN NB_OF_SESSIONS < 0 THEN NULL
        ELSE NB_OF_SESSIONS
    END AS NB_OF_SESSIONS,
    TRY_TO_NUMBER(NB_OF_SIGNUPS) AS NB_OF_SIGNUPS,
    -- Orders
    CASE 
        WHEN NB_OF_ORDERS < 0 THEN NULL
        ELSE NB_OF_ORDERS
    END AS NB_OF_ORDERS,

    -- Ordered items
    CASE 
        WHEN NB_OF_POSLITE_ITEMS_ORDERED < 0 THEN NULL
        ELSE NB_OF_POSLITE_ITEMS_ORDERED
    END AS NB_OF_POSLITE_ITEMS_ORDERED,

    -- Dispatched items
    CASE 
        WHEN NB_POSLITE_ITEMS_DISPATCHED < 0 THEN NULL
        ELSE NB_POSLITE_ITEMS_DISPATCHED
    END AS NB_POSLITE_ITEMS_DISPATCHED

FROM DATEV_TEST.DATEV_TEST.WEB_ORDERS;
